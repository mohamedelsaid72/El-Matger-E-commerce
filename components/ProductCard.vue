<template>
  <div class="product-card p-4 rounded-lg">
    <div
      class="flex w-100 mb-5"
      :class="{
        'justify-end': recommended,
        'justify-between': !recommended,
      }"
    >
      <div
        v-if="!recommended"
        class="sale w-[80px] h-[24px] rounded bg-[#de3618] flex items-center text-[12px] text-[#fff] justify-center gap-1 px-1"
      >
        <div>{{ $t("save") }}</div>
        <div>{{ product.discount }}</div>
      </div>
      <button
        :class="{ liked: isLiked }"
        @click="toggleLike(product.id)"
        class="like rounded-full p-3 w-[36px] h-[36px] flex items-center justify-center cursor-pointer"
      >
        <svg
          width="14"
          height="12"
          viewBox="0 0 14 12"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M7.31747 1.11161C8.80037 -0.370701 11.2046 -0.370701 12.6875 1.11161C14.1705 2.59402 14.1705 4.99753 12.6875 6.47994L7.28249 11.8828C7.1263 12.0389 6.87312 12.0389 6.71692 11.8828L1.31195 6.47994C-0.17104 4.99753 -0.17104 2.59402 1.31195 1.11161C2.79485 -0.370701 5.19904 -0.370701 6.68194 1.11161L6.99971 1.42926L7.31747 1.11161Z"
            fill="#5A7184"
          />
        </svg>
      </button>
    </div>
    <div class="product-image w-[174px] h-[174px] mx-auto">
      <img
        :src="
          'https://freestore.ezeestock.com/api/media/174x174/' +
          product.category.image
        "
        @error="handleProductImageError"
        alt="Product Image"
      />
    </div>
    <div class="product-info my-5">
      <div
        v-if="!recommended"
        class="product-category text-[#959ead] capitalize"
      >
        {{ product.category.name }}
      </div>
      <p class="product-title min-h-[50px]">
        {{ shortenText(product?.description) }}
      </p>
      <div class="product-price flex items-center justify-between my-3">
        <p class="new-price">{{ formatPrice(product?.price) }} L.E</p>
        <p v-if="recommended" class="old-price">
          <del>{{ formatPrice(product?.price_after_discount) }} L.E</del>
        </p>
        <svg
          v-if="!recommended"
          width="95"
          height="15"
          viewBox="0 0 95 15"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M4.99066 12.869C4.67374 13.0344 4.29034 13.0053 4.00205 12.7939C3.71375 12.5825 3.57072 12.2256 3.63322 11.8736L4.13906 8.97423L2.00942 6.93338C1.74911 6.68513 1.65371 6.30988 1.76385 5.96745C1.874 5.62503 2.17029 5.37576 2.52651 5.32583L5.48337 4.90316L6.8183 2.24017C6.97658 1.9208 7.30221 1.71876 7.65865 1.71876C8.01509 1.71876 8.34072 1.9208 8.499 2.24017L9.83393 4.90316L12.7908 5.32583C13.147 5.37576 13.4433 5.62503 13.5534 5.96745C13.6636 6.30988 13.5682 6.68513 13.3079 6.93338L11.1782 8.97423L11.6841 11.8742C11.7466 12.2262 11.6035 12.5831 11.3152 12.7945C11.027 13.0059 10.6436 13.035 10.3266 12.8696L7.65865 11.4909L4.99066 12.869Z"
            fill="#FFE923"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M7.65865 2.18751C7.48035 2.18751 7.31747 2.28857 7.2383 2.44832L7.23735 2.45024L5.90241 5.11322C5.83356 5.25056 5.70179 5.34545 5.5497 5.36719L2.59284 5.78987L2.59157 5.79005C2.41339 5.81502 2.26518 5.9397 2.21009 6.11099C2.15499 6.28227 2.20271 6.46998 2.33292 6.59415L2.33375 6.59494L4.46338 8.63579C4.57614 8.74384 4.62767 8.90095 4.60083 9.05479L4.095 11.9541L4.09475 11.9555C4.06349 12.1316 4.13503 12.3101 4.27924 12.4159C4.42345 12.5216 4.61523 12.5362 4.77375 12.4534L4.77554 12.4525L7.44353 11.0744C7.5785 11.0047 7.73889 11.0047 7.87384 11.0745L10.5418 12.4532L10.5435 12.4541C10.7021 12.5368 10.8938 12.5222 11.0381 12.4165C11.1823 12.3107 11.2538 12.1322 11.2225 11.9561L11.2223 11.9547L10.7165 9.05478C10.6896 8.90094 10.7412 8.74384 10.8539 8.63579L12.9835 6.59494L12.9844 6.59415C13.1146 6.46998 13.1623 6.28227 13.1072 6.11099C13.0521 5.93971 12.9039 5.81502 12.7257 5.79005L12.7245 5.78987L9.7676 5.36719C9.61551 5.34545 9.48373 5.25056 9.41488 5.11322L8.07899 2.44833C7.99982 2.28858 7.83694 2.18751 7.65865 2.18751ZM6.39881 2.03098C6.63639 1.5526 7.12445 1.25001 7.65865 1.25001C8.19282 1.25001 8.68086 1.55257 8.91845 2.03091L8.919 2.03202L10.1431 4.47383L12.8558 4.86162L12.8565 4.86172C13.3905 4.93683 13.8345 5.31057 13.9997 5.82392C14.1648 6.33712 14.022 6.89949 13.6322 7.27182L13.6314 7.2726L11.6829 9.1398L12.1456 11.7922L12.1458 11.7931C12.2391 12.3207 12.0246 12.8556 11.5924 13.1725C11.1604 13.4893 10.5858 13.5332 10.1107 13.2857L10.1097 13.2851L7.6586 12.0185L5.20757 13.2845L5.20642 13.2851C4.73133 13.5326 4.15688 13.4887 3.72485 13.1719C3.29268 12.855 3.07815 12.32 3.17156 11.7924L3.17169 11.7916L3.63434 9.1398L1.68592 7.2726L1.6854 7.27211C1.29538 6.89979 1.1525 6.33725 1.31762 5.82392C1.48275 5.31056 1.92682 4.93681 2.46079 4.86171L2.46145 4.86162L5.17423 4.47383L6.39881 2.03098Z"
            fill="#FFE923"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M24.9907 12.869C24.6737 13.0344 24.2903 13.0053 24.002 12.7939C23.7138 12.5825 23.5707 12.2256 23.6332 11.8736L24.1391 8.97423L22.0094 6.93338C21.7491 6.68513 21.6537 6.30988 21.7639 5.96745C21.874 5.62503 22.1703 5.37576 22.5265 5.32583L25.4834 4.90316L26.8183 2.24017C26.9766 1.9208 27.3022 1.71876 27.6586 1.71876C28.0151 1.71876 28.3407 1.9208 28.499 2.24017L29.8339 4.90316L32.7908 5.32583C33.147 5.37576 33.4433 5.62503 33.5534 5.96745C33.6636 6.30988 33.5682 6.68513 33.3079 6.93338L31.1782 8.97423L31.6841 11.8742C31.7466 12.2262 31.6035 12.5831 31.3152 12.7945C31.027 13.0059 30.6436 13.035 30.3266 12.8696L27.6586 11.4909L24.9907 12.869Z"
            fill="#FFE923"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M27.6586 2.18751C27.4804 2.18751 27.3175 2.28857 27.2383 2.44832L27.2373 2.45024L25.9024 5.11322C25.8336 5.25056 25.7018 5.34545 25.5497 5.36719L22.5928 5.78987L22.5916 5.79005C22.4134 5.81502 22.2652 5.9397 22.2101 6.11099C22.155 6.28227 22.2027 6.46998 22.3329 6.59415L22.3337 6.59494L24.4634 8.63579C24.5761 8.74384 24.6277 8.90095 24.6008 9.05479L24.095 11.9541L24.0948 11.9555C24.0635 12.1316 24.135 12.3101 24.2792 12.4159C24.4234 12.5216 24.6152 12.5362 24.7738 12.4534L24.7755 12.4525L27.4435 11.0744C27.5785 11.0047 27.7389 11.0047 27.8738 11.0745L30.5418 12.4532L30.5435 12.4541C30.7021 12.5368 30.8938 12.5222 31.0381 12.4165C31.1823 12.3107 31.2538 12.1322 31.2225 11.9561L31.2223 11.9547L30.7165 9.05478C30.6896 8.90094 30.7412 8.74384 30.8539 8.63579L32.9835 6.59494L32.9844 6.59415C33.1146 6.46998 33.1623 6.28227 33.1072 6.11099C33.0521 5.93971 32.9039 5.81502 32.7257 5.79005L32.7245 5.78987L29.7676 5.36719C29.6155 5.34545 29.4837 5.25056 29.4149 5.11322L28.079 2.44833C27.9998 2.28858 27.8369 2.18751 27.6586 2.18751ZM26.3988 2.03098C26.6364 1.5526 27.1245 1.25001 27.6586 1.25001C28.1928 1.25001 28.6809 1.55257 28.9184 2.03091L28.919 2.03202L30.1431 4.47383L32.8558 4.86162L32.8565 4.86172C33.3905 4.93683 33.8345 5.31057 33.9997 5.82392C34.1648 6.33712 34.022 6.89949 33.6322 7.27182L33.6314 7.2726L31.6829 9.1398L32.1456 11.7922L32.1458 11.7931C32.2391 12.3207 32.0246 12.8556 31.5924 13.1725C31.1604 13.4893 30.5858 13.5332 30.1107 13.2857L30.1097 13.2851L27.6586 12.0185L25.2076 13.2845L25.2064 13.2851C24.7313 13.5326 24.1569 13.4887 23.7249 13.1719C23.2927 12.855 23.0782 12.32 23.1716 11.7924L23.1717 11.7916L23.6343 9.1398L21.6859 7.2726L21.6854 7.27211C21.2954 6.89979 21.1525 6.33725 21.3176 5.82392C21.4828 5.31056 21.9268 4.93681 22.4608 4.86171L22.4614 4.86162L25.1742 4.47383L26.3988 2.03098Z"
            fill="#FFE923"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M44.9907 12.869C44.6737 13.0344 44.2903 13.0053 44.002 12.7939C43.7138 12.5825 43.5707 12.2256 43.6332 11.8736L44.1391 8.97423L42.0094 6.93338C41.7491 6.68513 41.6537 6.30988 41.7639 5.96745C41.874 5.62503 42.1703 5.37576 42.5265 5.32583L45.4834 4.90316L46.8183 2.24017C46.9766 1.9208 47.3022 1.71876 47.6586 1.71876C48.0151 1.71876 48.3407 1.9208 48.499 2.24017L49.8339 4.90316L52.7908 5.32583C53.147 5.37576 53.4433 5.62503 53.5534 5.96745C53.6636 6.30988 53.5682 6.68513 53.3079 6.93338L51.1782 8.97423L51.6841 11.8742C51.7466 12.2262 51.6035 12.5831 51.3152 12.7945C51.027 13.0059 50.6436 13.035 50.3266 12.8696L47.6586 11.4909L44.9907 12.869Z"
            fill="#FFE923"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M47.6586 2.18751C47.4804 2.18751 47.3175 2.28857 47.2383 2.44832L47.2373 2.45024L45.9024 5.11322C45.8336 5.25056 45.7018 5.34545 45.5497 5.36719L42.5928 5.78987L42.5916 5.79005C42.4134 5.81502 42.2652 5.9397 42.2101 6.11099C42.155 6.28227 42.2027 6.46998 42.3329 6.59415L42.3337 6.59494L44.4634 8.63579C44.5761 8.74384 44.6277 8.90095 44.6008 9.05479L44.095 11.9541L44.0948 11.9555C44.0635 12.1316 44.135 12.3101 44.2792 12.4159C44.4234 12.5216 44.6152 12.5362 44.7738 12.4534L44.7755 12.4525L47.4435 11.0744C47.5785 11.0047 47.7389 11.0047 47.8738 11.0745L50.5418 12.4532L50.5435 12.4541C50.7021 12.5368 50.8938 12.5222 51.0381 12.4165C51.1823 12.3107 51.2538 12.1322 51.2225 11.9561L51.2223 11.9547L50.7165 9.05478C50.6896 8.90094 50.7412 8.74384 50.8539 8.63579L52.9835 6.59494L52.9844 6.59415C53.1146 6.46998 53.1623 6.28227 53.1072 6.11099C53.0521 5.93971 52.9039 5.81502 52.7257 5.79005L52.7245 5.78987L49.7676 5.36719C49.6155 5.34545 49.4837 5.25056 49.4149 5.11322L48.079 2.44833C47.9998 2.28858 47.8369 2.18751 47.6586 2.18751ZM46.3988 2.03098C46.6364 1.5526 47.1245 1.25001 47.6586 1.25001C48.1928 1.25001 48.6809 1.55257 48.9184 2.03091L48.919 2.03202L50.1431 4.47383L52.8558 4.86162L52.8565 4.86172C53.3905 4.93683 53.8345 5.31057 53.9997 5.82392C54.1648 6.33712 54.022 6.89949 53.6322 7.27182L53.6314 7.2726L51.6829 9.1398L52.1456 11.7922L52.1458 11.7931C52.2391 12.3207 52.0246 12.8556 51.5924 13.1725C51.1604 13.4893 50.5858 13.5332 50.1107 13.2857L50.1097 13.2851L47.6586 12.0185L45.2076 13.2845L45.2064 13.2851C44.7313 13.5326 44.1569 13.4887 43.7249 13.1719C43.2927 12.855 43.0782 12.32 43.1716 11.7924L43.1717 11.7916L43.6343 9.1398L41.6859 7.2726L41.6854 7.27211C41.2954 6.89979 41.1525 6.33725 41.3176 5.82392C41.4828 5.31056 41.9268 4.93681 42.4608 4.86171L42.4614 4.86162L45.1742 4.47383L46.3988 2.03098Z"
            fill="#FFE923"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M67.5031 2.34209C67.3248 2.34209 67.162 2.44315 67.0828 2.6029L67.0818 2.60482L65.7469 5.2678C65.6781 5.40514 65.5463 5.50003 65.3942 5.52177L62.4373 5.94445L62.4361 5.94463C62.2579 5.9696 62.1097 6.09428 62.0546 6.26557C61.9995 6.43685 62.0472 6.62456 62.1774 6.74873L62.1782 6.74952L64.3079 8.79037C64.4206 8.89842 64.4722 9.05553 64.4453 9.20937L63.9395 12.1087L63.9392 12.1101C63.908 12.2862 63.9795 12.4647 64.1237 12.5704C64.2679 12.6762 64.4597 12.6908 64.6182 12.608L64.62 12.6071L67.288 11.229C67.423 11.1593 67.5834 11.1593 67.7183 11.229L70.3863 12.6077L70.388 12.6086C70.5466 12.6914 70.7383 12.6768 70.8825 12.5711C71.0268 12.4653 71.0983 12.2868 71.067 12.1107L71.0668 12.1093L70.561 9.20935C70.5341 9.05552 70.5857 8.89842 70.6984 8.79037L72.828 6.74952L72.8289 6.74873C72.9591 6.62456 73.0068 6.43685 72.9517 6.26557C72.8966 6.09428 72.7484 5.9696 72.5702 5.94463L72.5689 5.94445L69.6121 5.52177C69.46 5.50003 69.3282 5.40514 69.2594 5.2678L67.9235 2.60291C67.8443 2.44315 67.6814 2.34209 67.5031 2.34209ZM66.2433 2.18556C66.4809 1.70718 66.9689 1.40459 67.5031 1.40459C68.0373 1.40459 68.5253 1.70715 68.7629 2.18549L68.7635 2.1866L69.9876 4.62841L72.7003 5.0162L72.701 5.0163C73.235 5.09141 73.679 5.46515 73.8442 5.97849C74.0092 6.4917 73.8665 7.05407 73.4767 7.42639L73.4759 7.42718L71.5274 9.29438L71.9901 11.9468L71.9902 11.9477C72.0836 12.4753 71.8691 13.0102 71.4369 13.3271C71.0049 13.6439 70.4303 13.6878 69.9552 13.4402L69.9542 13.4397L67.5031 12.1731L65.0521 13.4391L65.0509 13.4397C64.5758 13.6871 64.0014 13.6433 63.5693 13.3265C63.1372 13.0095 62.9226 12.4746 63.016 11.9469L63.0162 11.9462L63.4788 9.29437L61.5304 7.42718L61.5299 7.42668C61.1399 7.05436 60.997 6.49183 61.1621 5.97849C61.3272 5.46514 61.7713 5.09139 62.3053 5.01629L62.3059 5.0162L65.0187 4.62841L66.2433 2.18556Z"
            fill="#FFE923"
          />
          <path
            d="M67.5 1.87334C67.1448 1.8745 66.8206 2.0763 66.6628 2.39475L65.3278 5.05773L62.371 5.48041C62.0148 5.53034 61.7185 5.7796 61.6083 6.12203C61.4982 6.46445 61.5936 6.83971 61.8539 7.08795L63.9835 9.1288L63.4777 12.0281C63.4152 12.3801 63.5582 12.737 63.8465 12.9484C64.1348 13.1598 64.5182 13.189 64.8351 13.0235L67.5 11.6471V1.87334Z"
            fill="#FFE923"
          />
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M87.5031 2.34208C87.3248 2.34208 87.1619 2.44314 87.0828 2.6029L87.0818 2.60481L85.7469 5.26779C85.678 5.40514 85.5463 5.50002 85.3942 5.52176L82.4373 5.94444L82.4361 5.94462C82.2579 5.96959 82.1097 6.09428 82.0546 6.26556C81.9995 6.43685 82.0472 6.62455 82.1774 6.74873L82.1782 6.74951L84.3079 8.79036C84.4206 8.89842 84.4722 9.05552 84.4453 9.20936L83.9395 12.1087L83.9392 12.1101C83.908 12.2862 83.9795 12.4647 84.1237 12.5704C84.2679 12.6762 84.4597 12.6908 84.6182 12.608L84.62 12.6071L87.288 11.229C87.423 11.1593 87.5834 11.1593 87.7183 11.229L90.3863 12.6077L90.388 12.6086C90.5465 12.6914 90.7383 12.6768 90.8825 12.5711C91.0267 12.4653 91.0983 12.2868 91.067 12.1107L91.0668 12.1093L90.5609 9.20935C90.5341 9.05551 90.5856 8.89841 90.6984 8.79036L92.828 6.74951L92.8289 6.74873C92.9591 6.62455 93.0068 6.43685 92.9517 6.26556C92.8966 6.09428 92.7484 5.96959 92.5702 5.94462L92.5689 5.94444L89.6121 5.52176C89.46 5.50002 89.3282 5.40514 89.2594 5.26779L87.9235 2.6029C87.8443 2.44315 87.6814 2.34208 87.5031 2.34208ZM86.2433 2.18556C86.4809 1.70717 86.9689 1.40458 87.5031 1.40458C88.0373 1.40458 88.5253 1.70714 88.7629 2.18548C88.7631 2.18585 88.7633 2.18622 88.7635 2.1866L89.9875 4.6284L92.7003 5.01619C92.7006 5.01623 92.7008 5.01626 92.701 5.01629C93.235 5.0914 93.679 5.46514 93.8442 5.97849C94.0092 6.49169 93.8665 7.05406 93.4767 7.42639C93.4767 7.4264 93.4767 7.42638 93.4767 7.42639C93.4764 7.42664 93.4761 7.42692 93.4759 7.42718L91.5274 9.29437L91.9901 11.9468C91.9901 11.9471 91.9902 11.9474 91.9902 11.9476C92.0836 12.4753 91.8691 13.0102 91.4369 13.3271C91.0048 13.6439 90.4303 13.6878 89.9552 13.4402C89.9549 13.4401 89.9545 13.4399 89.9542 13.4397L87.5031 12.1731L85.052 13.4391C85.0517 13.4393 85.0513 13.4395 85.0509 13.4397C84.5758 13.6871 84.0014 13.6433 83.5693 13.3265C83.1372 13.0095 82.9226 12.4746 83.016 11.9469C83.0161 11.9467 83.0161 11.9464 83.0162 11.9462L83.4788 9.29437L81.5304 7.42718C81.5302 7.42701 81.53 7.42684 81.5299 7.42668C81.1399 7.05436 80.997 6.49182 81.1621 5.97849C81.3272 5.46513 81.7713 5.09138 82.3053 5.01629C82.3055 5.01625 82.3057 5.01622 82.3059 5.01619L85.0187 4.6284L86.2433 2.18556Z"
            fill="#D6D6D6"
          />
        </svg>
      </div>
    </div>
    <div
      v-if="recommended"
      class="product-buttons flex items-center justify-center"
    >
      <button
        @click="toggleProductInCart(product)"
        class="add-to-cart pa-3 w-[183px] h-[38px] rounded-md"
      >
        {{
          cartStore.isInCart(product)
            ? `${$t("removeFromCart")}`
            : `${$t("addToCart")}`
        }}
      </button>
    </div>
  </div>
</template>

<script setup>
const { locale } = useI18n();

const props = defineProps({
  product: {
    type: Object,
  },
  recommended: {
    type: Boolean,
    default: true,
  },
});
const cartStore = useCartStore();
const userLoggedIn = ref(false);

onMounted(() => {
  if (localStorage.getItem("userLoggedIn")) {
    userLoggedIn.value = true;
  } else {
    userLoggedIn.value = false;
  }
});

const toggleProductInCart = (product) => {
  if (userLoggedIn.value) {
    cartStore.toggleProductInCart(product);
  } else {
    navigateTo(`/${locale.value}/login`);
  }
};

const getLocalStorage = () => {
  return localStorage.getItem("likedItems")
    ? JSON.parse(localStorage.getItem("likedItems"))
    : [];
};

const isLiked = ref(getLocalStorage().includes(props.product.id));

function toggleLike(id) {
  const likedItems = getLocalStorage();
  if (likedItems.includes(id)) {
    likedItems.splice(likedItems.indexOf(id), 1);
    localStorage.setItem("likedItems", JSON.stringify(likedItems));
    isLiked.value = false;
  } else {
    likedItems.push(id);
    addToLcalStorage(id);
    isLiked.value = true;
  }
}

function addToLcalStorage(id) {
  const likedItems = getLocalStorage();
  likedItems.push(id);
  localStorage.setItem("likedItems", JSON.stringify(likedItems));
}

const formatPrice = (price) => {
  return Number(price).toFixed(2);
};

const handleProductImageError = (event) => {
  event.target.src = "https://via.placeholder.com/174x174.png?text=No+Image";
};

const shortenText = (text) => {
  if (text.length > 50) {
    return text.substring(0, 50) + "...";
  }
  return text;
};
</script>

<style lang="scss" scoped></style>
